---
title: "Postgresql и Rails"
ref: Postgresql-and-rails
layout: post
lang: ru
---

Привет, сегодня хотел рассказать об объектно-реляционных базах данных(бд - далее), систем управления базами данных(СУБД - далее)
и PostgreSQL в частности. О PostgreSQL буду рассказывать на примере небольшого
rails-приложения, где буду с нуля всё настраивать и показывать её использование.

### Что же такое база данных?
Итак, база данных - ~~просто база данных, чего непонятного?~~ просто множество упорядоченной информации, хаха :smile:  

Тогда следующий вопрос(Для студента первого курса, сдающего ОВТ), а вот библиотека или какой-нибудь справочник-книга - база данных?   
Ну нет! У программистов какие-то свои базы данных.   
Короче, базы данных в нашем понимании - просто такой способ упорядочивания информации,
чтобы с ним могла автоматически работать специальная прогрмма(СУБД). Способ упорядочивания -
представдение данных(В виде таблиц, объектов) и метаданные(описание адресов таблиц, к примеру)
Способов упорядочивания информации может быть разным, от этого и типов баз данных много, например:  

* Реляционная база данных - данные хранятся в таблицах, которые могу ссылаться(кelation - cвязь) друг на друга.
* Объектная база данных - объектная структура, т.е. обычная куча любой вртуальной машины.
* Объектно-реляционная база данных - Реляционная бд с *встроенной поддержкой наследования*, *кастомными методами*, и
*кастомными типами*, а не только стандартными TEXT, INTEGER, а например, типом PERSON.
* Иерархическая база данных - древовидная структура, где некоторые объекты включены друг в друга по старшинству. Например,
объект покупатель(предок) включал бы в себя несколько заказов(потомок), которые включали бы в себя какие-нибудь
покупки(потомок потомка)
* Сетевая база данных - аналагична иерархической базе данных, но потомки могут имень несколько предков

Ещё раз, для дураков, я вот всегда любил читать такие предложения :smile:
База данных - просто файл с кучей таблиц и метаданными(самоописанием, тому, как она устроена). Благодаря
метаднным СУБД знает, где же находится та или иная таблица, и может добалвять, читать, изменять и удалять информацию.

### Что такое Система Управления Базами Данных?
СУБД - программа для манипуляции бд, всё :laughing:
Например, вот сейчас у меня есть PostgreSQL, и я мгу написать чт

```sql
# Зайдём по пользователем postgres
$ sudo -u postgres psql

# Попросим все доступные таблица из бд
postgres=# select * from information_schema.tables

# Cоздадим новую таблицу
postgres=# CREATE TABLE table_name(
   name TEXT,
   surname TEXT,
   PRIMARY KEY(surname)
);
```

СУБД состоит из:

* Ядра, которое отвечает за управление данными во внешней и оперативной памяти и журнализацию,
* Машинно-независимого языка для доступа к данным
* Процессора языка базы данных, обеспечивающий оптимизацию запросов на извлечение и изменение данных.
* Подсистемы поддержки времени исполнения, как-бы интерпретатор sql-запросов.

### Зачем нужны БД и СУБД?
Ну вот представьте, вам нужно сохранить множества записей в таблицах, да ещё и так,
чтобы это всё было логически связано и быстро работало. Почему-бы не хранить данные в
json или xml и не быть счастливыми? Да потому что раньше так и делали, а потом нашли
недостатки у этого подхода, и придумали базы данных.  
Итак, что-же можно делать с бд, чего нельзя делать с простым хранением в каком-либо стандартном формате:

1. Можно запрашивать данные из бд (задавать ей вопросы :smile:), и это всё быстрей самописных алгоритмов поиска
2. Можно строить связи между сущностями, а так-же соединять запрошенные данные
3. Встроенная структура данных, которая и делает всё относительно быстрым
4. Инофрмация оного объекта хранится в еинственном экземпляре из-за связей
5. ACID(Atomicity, Consistency, Isolation, Durability), если вкратце, то одновременные операции над бд не будут друг-другу мешать.
6. Базы данных простительны к ошибкам, например, можно частично восстанавливать базы данных :dissapointed:
7. Базы данных могут обрабатывать реально огромные множества данных.
С другом на одном Джава-проекте тащили порядка ста тысяч сущностей где-то секунд за 15 :smile:
8. Базы данных хорошо расширяются
9. Записи и удаления могу откладываться до момента необходимости, чтобы не занимать процессорное время
10. Логи

### Реляционные базы данных:
Тут есть немного терминологии. Суть:
Каждая строка в таблице - запись, она уникальна, и хоть одной колонкой обязана отличаться.
Данные представлены таблицами. В каждой таблице есть уникальный ключ, который помогает инедтифицировать каждую запись, и только одну.
Например, в таблице с колонками Фамилия-Имя ключом может быть фамилия. Естественный ключ.  

![natural key](/resources/images/natural-key.png)

Но а что, если фамилии повторяются?
Тогда ключом может быть новая колонка ID - суррогатный ключ.  

![surrogate key](/resources/images/surrogate-key.png)

Или комбинация Имени и Фамилии - составным ключом.
Или же можно придумать Интеллектуальный ключ - составленный из данных в таблце.

Также, в записях могу содержаться ссылки на первичные ключи других таблиц - внешние ключи.
Store_id и author_id - внешние ключи.

![foreign key](/resources/images/foreign-keys.png)

Связи между таблицами могут быть:
* Одна или ноль
* Только один
* Много или ноль
* Много или один

Для удобной работы человеку нужна схема бд. Так вот, схема бд будет выглядеть примерно так:

![natural key](/resources/images/db-scheme.png)

#### Да простит меня https://quickleft.com , у которого я стырил картинки.
Скоро вставлю свои

### Язык SQL
CRUD - Create, Read, Update, Delete

+ Запросы к субд

Ой, продолжение следует, меня не хватает :)))))

### Таблицы в Ruby

![ruby tables](/resources/images/ruby-sample.png)

### Почему именно Postgresql?
Ну блин, мне сказали, мол, в проекте используем PostgreSQL, я и начал её смотреть :smile:
Вообще, PostgreSQL - объектно-реляционная и бесплатная. В отличие от той-же mySQL.

### Простой проект
Итак, для начала, необходимо удостовериться, что все надлежащие пакеты установлены.

Настраиваем PostgreSQL.

```bash
# Обновляем доступные пакеты нашего пакетного менедера
$ sudo apt-get update
# Ставим PostgreSQL и его разрабатываемые библиотеки
$ sudo apt-get install postgresql postgresql-contrib libpq-dev
# Создаём пользователя нашей субд
$ sudo -u postgres createuser -s pguser --password
```

Если у вас не стоит Ruby, то ставим его, вот [статья](/youGotFooled) от меня, разбирающая Ruby Development Kit, т.е. те утилиты, которыми
ты будешь пользоваться, используя Руби

Создаём простое rails-приложение

```bash
$ cd ~/Code/RailsSamples/
$ rails new postgresql_sample_app -d postgresql
$ cd postgresql_sample_app

# Ставим нашего созданного пользователя оператором СУБД
$ vim config/database.yml
# Ищем там строку pool: 5 и добавляем следующее, заменяя pguser и pguser_password на свои.
  host: localhost
  username: pguser
  password: pguser_password
# Сохрняем и выходим.

# Создаём базы данных development и test
$ rake db:create

# Тестируем. После исполнения следующего идём браузером по localhos:3000
$ rails server
```

Если всё взлетело, то бд успешно установлена, и теперь её можо использовать,
как и любую другую.

#### Ну всё, ты успешен!
Теперь можно делать что захочешь. Допишу в течении недели.
